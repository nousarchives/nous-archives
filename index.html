<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.9">
    <title>NousArchives</title>
    <link rel="icon" type="image/jpeg" href="logo_color.jpg">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@300;400;500&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script>
        (function() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
</head>
<body>

    <nav class="topnav">
        <span class="nav-left">EST. ENE 24</span>
        <a href="/" class="nav-center" aria-label="nous Archives">
            <span class="nav-wordmark" id="nav-wordmark">
                <span class="ht-n">n</span><span class="ht-ous">ous</span><span class="ht-line" aria-hidden="true"></span><span class="ht-A">A</span><span class="ht-rchives">rchives</span>
            </span>
        </a>
        <div class="nav-links">
            <button class="dark-toggle" id="dark-toggle" aria-label="Modo oscuro">◐</button>
            <a href="archivo.html">Archivo</a>
            <a href="https://youtube.com/@NousArchives" target="_blank">YouTube ↗</a>
            <a href="https://github.com/nousarchives/blog" target="_blank">GitHub ↗</a>
        </div>
    </nav>

    <main class="content">

        <div class="hero-meta-large">
            <span>Volumen I</span>
        </div>

        <div class="home-logo">
            <img src="logo_color.jpg" alt="nousArchives">
        </div>

        <!-- ── ARCHIVADOR ── -->
        <section class="cabinet-section">
            <div class="cabinet" id="cabinet">

                <!-- Logo en la cara superior del armario -->
                <div class="cab-top-logo" aria-hidden="true">
                    <img src="logo.png" alt="">
                </div>

                <!-- Aristas ocultas: líneas discontinuas para las aristas traseras -->
                <div class="cab-hidden-edges" aria-hidden="true">
                    <div class="cab-edge-back-left"></div>
                    <div class="cab-edge-back-right"></div>
                    <div class="cab-edge-back-bottom"></div>
                    <div class="cab-edge-depth-left"></div>
                </div>

                <!-- Cajón 1: Publicaciones -->
                <div class="cab-drawer" id="drawer-posts" data-drawer="posts">
                    <div class="cab-drawer-front">
                        <div class="cab-drawer-label">Publicaciones</div>
                        <div class="cab-drawer-handle"></div>
                    </div>
                    <div class="cab-drawer-interior">
                        <div class="cab-folders" id="folders-posts">
                            <a class="cab-folder" data-tag="all" href="#">
                                <div class="cab-folder-tab">Todas</div>
                                <div class="cab-folder-body"></div>
                            </a>
                            <a class="cab-folder" data-tag="ia" href="#">
                                <div class="cab-folder-tab">IA</div>
                                <div class="cab-folder-body"></div>
                            </a>
                            <a class="cab-folder" data-tag="ml" href="#">
                                <div class="cab-folder-tab">ML</div>
                                <div class="cab-folder-body"></div>
                            </a>
                            <a class="cab-folder" data-tag="cine" href="#">
                                <div class="cab-folder-tab">Cine</div>
                                <div class="cab-folder-body"></div>
                            </a>
                            <a class="cab-folder" data-tag="literatura" href="#">
                                <div class="cab-folder-tab">Literatura</div>
                                <div class="cab-folder-body"></div>
                            </a>
                            <a class="cab-folder" data-tag="musica" href="#">
                                <div class="cab-folder-tab">Música</div>
                                <div class="cab-folder-body"></div>
                            </a>
                            <a class="cab-folder" data-tag="derecho" href="#">
                                <div class="cab-folder-tab">Derecho</div>
                                <div class="cab-folder-body"></div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Cajón 2: YouTube -->
                <div class="cab-drawer" id="drawer-yt" data-drawer="yt">
                    <div class="cab-drawer-front">
                        <div class="cab-drawer-label">YouTube</div>
                        <div class="cab-drawer-handle"></div>
                    </div>
                    <div class="cab-drawer-interior">
                        <div class="cab-folders" id="folders-yt">
                            <a class="cab-folder" href="https://www.youtube.com/watch?v=JpIcpDncl2M" target="_blank">
                                <div class="cab-folder-tab">▶</div>
                                <div class="cab-folder-body">
                                    <img src="https://img.youtube.com/vi/JpIcpDncl2M/maxresdefault.jpg" alt="" loading="lazy">
                                    <span>El arte sobre la emoción incapturable</span>
                                </div>
                            </a>
                            <a class="cab-folder" href="https://www.youtube.com/watch?v=p6Cb26p5ihU" target="_blank">
                                <div class="cab-folder-tab">▶</div>
                                <div class="cab-folder-body">
                                    <img src="https://img.youtube.com/vi/p6Cb26p5ihU/maxresdefault.jpg" alt="" loading="lazy">
                                    <span>Me acerqué al arte buscando consuelo</span>
                                </div>
                            </a>
                            <a class="cab-folder" href="https://www.youtube.com/watch?v=OAy-HGAixOY" target="_blank">
                                <div class="cab-folder-tab">▶</div>
                                <div class="cab-folder-body">
                                    <img src="https://img.youtube.com/vi/OAy-HGAixOY/maxresdefault.jpg" alt="" loading="lazy">
                                    <span>La melodía en The Strokes</span>
                                </div>
                            </a>
                            <a class="cab-folder" href="https://www.youtube.com/watch?v=ICJSfJen7_Y" target="_blank">
                                <div class="cab-folder-tab">▶</div>
                                <div class="cab-folder-body">
                                    <img src="https://img.youtube.com/vi/ICJSfJen7_Y/hqdefault.jpg" alt="" loading="lazy">
                                    <span>Top Descubrimientos 2024</span>
                                </div>
                            </a>
                            <a class="cab-folder" href="https://www.youtube.com/watch?v=ouypYh61fKo" target="_blank">
                                <div class="cab-folder-tab">▶</div>
                                <div class="cab-folder-body">
                                    <img src="https://img.youtube.com/vi/ouypYh61fKo/maxresdefault.jpg" alt="" loading="lazy">
                                    <span>Natalia Lafourcade — De todas las flores</span>
                                </div>
                            </a>
                            <a class="cab-folder" href="https://www.youtube.com/watch?v=QRjorGBwzzc" target="_blank">
                                <div class="cab-folder-tab">▶</div>
                                <div class="cab-folder-body">
                                    <img src="https://img.youtube.com/vi/QRjorGBwzzc/maxresdefault.jpg" alt="" loading="lazy">
                                    <span>¿Perdemos creatividad al priorizar el orden?</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Cajón 3: Autores -->
                <div class="cab-drawer" id="drawer-authors" data-drawer="authors">
                    <div class="cab-drawer-front">
                        <div class="cab-drawer-label">Autores</div>
                        <div class="cab-drawer-handle"></div>
                    </div>
                    <div class="cab-drawer-interior">
                        <div class="cab-folders" id="folders-authors">
                            <a class="cab-folder cab-folder--author" href="angel/" data-slug="angel">
                                <div class="cab-folder-tab cab-folder-tab--initial">Á</div>
                                <div class="cab-folder-body">
                                    <span class="cab-author-name">Ángel Allepuz</span>
                                    <span class="cab-author-count" data-slug="angel">— entradas</span>
                                </div>
                            </a>
                            <a class="cab-folder cab-folder--author" href="antonio/" data-slug="antonio">
                                <div class="cab-folder-tab cab-folder-tab--initial">A</div>
                                <div class="cab-folder-body">
                                    <span class="cab-author-name">Antonio</span>
                                    <span class="cab-author-count" data-slug="antonio">— entradas</span>
                                </div>
                            </a>
                            <a class="cab-folder cab-folder--author" href="javi/" data-slug="javi">
                                <div class="cab-folder-tab cab-folder-tab--initial">J</div>
                                <div class="cab-folder-body">
                                    <span class="cab-author-name">Javi</span>
                                    <span class="cab-author-count" data-slug="javi">— entradas</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Panel de publicaciones -->
        <section class="publications" id="publications-panel" style="display:none;">
            <div id="featured-post"></div>
            <div class="pub-list" id="pub-list"></div>
            <div class="pub-empty" id="no-results" style="display:none;">
                <span class="pub-empty-glyph">∅</span>
                <p>Nada en esta sección todavía.</p>
            </div>
        </section>

    </main>

    <footer class="footer">
        <div class="footer-bottom">
            <span>Contenido bajo <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> · Código bajo <a href="LICENSE">MIT</a></span>
        </div>
    </footer>

    <button class="back-to-top" id="back-to-top" aria-label="Volver arriba">↑</button>


    <script src="posts.js"></script>
    <script>
        // ── RENDER PUBLICACIONES ──
        function renderPosts(filterTag = 'all') {
            const pubList = document.getElementById('pub-list');
            const featuredEl = document.getElementById('featured-post');
            const noResults = document.getElementById('no-results');
            if (!pubList) return;
            pubList.innerHTML = '';
            featuredEl.innerHTML = '';
            let visibleCount = 0;
            if (typeof POSTS === 'undefined') return;
            const filtered = POSTS.filter(post => filterTag === 'all' || post.tags.includes(filterTag));
            filtered.forEach((post, idx) => {
                visibleCount++;
                const tagsHTML = post.tags.map(t => `<span class="pub-tag">${t}</span>`).join('');
                const typeLabel = post.type.charAt(0).toUpperCase() + post.type.slice(1);
                if (idx === 0 && filterTag === 'all') {
                    const el = document.createElement('a');
                    el.href = post.url;
                    el.className = 'pub-item-featured';
                    el.innerHTML = `
                        <div class="pub-center">
                            <div class="pub-featured-label">Última entrada</div>
                            <span class="pub-title">${post.title}</span>
                            <span class="pub-tldr">${post.tldr}</span>
                            <div class="pub-tags">${tagsHTML}</div>
                        </div>
                        <div class="pub-right">
                            <span class="pub-author">${post.author}</span>
                            <span class="pub-date">${post.date}</span>
                            <span class="pub-type ${post.type}">${typeLabel}</span>
                            <span class="pub-readtime">${post.readtime}</span>
                        </div>`;
                    featuredEl.appendChild(el);
                    return;
                }
                const item = document.createElement('a');
                item.href = post.url;
                item.className = 'pub-item';
                item.innerHTML = `
                    <div class="pub-left">
                        <span class="pub-author">${post.author}</span>
                        <span class="pub-date">${post.date}</span>
                    </div>
                    <div class="pub-center">
                        <span class="pub-title">${post.title}</span>
                        <span class="pub-tldr">${post.tldr}</span>
                        <div class="pub-tags">${tagsHTML}</div>
                    </div>
                    <div class="pub-right">
                        <span class="pub-type ${post.type}">${typeLabel}</span>
                        <span class="pub-readtime">${post.readtime}</span>
                    </div>`;
                pubList.appendChild(item);
            });
            if (noResults) noResults.style.display = visibleCount === 0 ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {

            // ── ARCHIVADOR ──
            const drawers = document.querySelectorAll('.cab-drawer');
            let focusedDrawer = null;  // cajón en modo zoom (click)
            let hoverDrawer = null;    // cajón con hover (abierto temporalmente)
            let justZoomed = false;    // bloquea el click de carpeta cuando se acaba de hacer zoom

            function openDrawerAnim(drawer) {
                drawer.classList.add('open');
            }
            function closeDrawerAnim(drawer) {
                drawer.classList.remove('open');
            }

            function zoomIntoDrawer(drawer) {
                drawers.forEach(d => {
                    if (d !== drawer) d.classList.add('cab-drawer--hidden');
                });
                drawer.classList.add('cab-drawer--focused');
                focusedDrawer = drawer;

                // Bloquear clicks de carpeta hasta que se suelte el ratón
                justZoomed = true;
                window.addEventListener('mouseup', () => { justZoomed = false; }, { once: true });

                // Rotar armario a vista desde arriba 45°, sin girar en Y
                rotX = -28;
                rotY = 0;
                applyRotation();

                // Panel publicaciones
                // Panel de publicaciones se muestra solo cuando el usuario clica una carpeta
            }

            function zoomOut() {
                if (!focusedDrawer) return;
                drawers.forEach(d => d.classList.remove('cab-drawer--hidden'));
                focusedDrawer.classList.remove('cab-drawer--focused');
                focusedDrawer = null;

                // Restaurar ángulo original
                rotX = -12;
                rotY = -22;
                applyRotation();

                const panel = document.getElementById('publications-panel');
                if (panel) panel.style.display = 'none';
            }

            drawers.forEach(drawer => {
                const front = drawer.querySelector('.cab-drawer-front');

                // HOVER → abre el cajón
                drawer.addEventListener('mouseenter', () => {
                    if (focusedDrawer) return; // en modo zoom no hacer hover
                    hoverDrawer = drawer;
                    openDrawerAnim(drawer);
                });
                drawer.addEventListener('mouseleave', () => {
                    if (focusedDrawer) return;
                    if (drawer === hoverDrawer) {
                        closeDrawerAnim(drawer);
                        hoverDrawer = null;
                    }
                });

                // CLICK → zoom hacia el interior
                front.addEventListener('click', () => {
                    if (focusedDrawer === drawer) {
                        // Segundo click: salir del zoom
                        zoomOut();
                        return;
                    }
                    if (focusedDrawer) zoomOut();
                    openDrawerAnim(drawer);
                    zoomIntoDrawer(drawer);
                });

                // Posicionar carpetas en Z
                const folders = drawer.querySelectorAll('.cab-folder');
                const folderSpacing = 58;
                folders.forEach((folder, fi) => {
                    const tz = fi * folderSpacing;
                    folder.style.transform = `translateZ(${tz}px)`;
                    folder.style.setProperty('--lift-z', `${tz}px`);
                    folder.style.setProperty('--folder-index', fi);
                    // La más al frente (último índice) tiene mayor z-index en 2D
                    folder.style.zIndex = fi + 1;
                });

                // Carpetas: hover → sale hacia fuera; click en carpeta abre el cajón si no está en zoom
                folders.forEach(folder => {
                    folder.addEventListener('click', e => {
                        if (justZoomed) {
                            // Click coincide con el zoom: bloquearlo siempre
                            e.preventDefault();
                            e.stopImmediatePropagation();
                            return;
                        }
                        if (!focusedDrawer) {
                            // Aún no estamos en zoom: abrir y hacer zoom en este cajón
                            e.preventDefault();
                            openDrawerAnim(drawer);
                            zoomIntoDrawer(drawer);
                        }
                    }, true); // capture

                    folder.addEventListener('mouseenter', () => {
                        if (!focusedDrawer) return;
                        folders.forEach(f => {
                            if (f !== folder) {
                                f.classList.add('dimmed');
                                // Restaurar posición de las no-hovereadas
                                const ftz = f.style.getPropertyValue('--lift-z') || '0px';
                                f.style.transform = `translateZ(${ftz})`;
                            }
                        });
                        const tz = parseFloat(folder.style.getPropertyValue('--lift-z')) || 0;
                        folder.style.transform = `translateZ(${tz}px) translateY(-120px)`;
                    });
                    folder.addEventListener('mouseleave', () => {
                        if (!focusedDrawer) return;
                        folders.forEach(f => f.classList.remove('dimmed'));
                        const tz = folder.style.getPropertyValue('--lift-z') || '0px';
                        folder.style.transform = `translateZ(${tz})`;
                    });

                    // Carpetas de publicaciones: filtrar — solo si ya estamos en zoom
                    if (drawer.dataset.drawer === 'posts') {
                        folder.addEventListener('click', e => {
                            e.preventDefault();
                            if (!focusedDrawer || justZoomed) return; // solo dentro del cajón abierto
                            const tag = folder.dataset.tag;
                            folders.forEach(f => f.classList.remove('active'));
                            folder.classList.add('active');
                            renderPosts(tag);
                            const panel = document.getElementById('publications-panel');
                            if (panel) {
                                panel.style.display = 'block';
                                setTimeout(() => panel.scrollIntoView({ behavior: 'smooth', block: 'start' }), 50);
                            }
                        });
                    }
                });
            });

            // Click fuera del armario → salir del zoom
            document.addEventListener('click', e => {
                if (focusedDrawer && !e.target.closest('#cabinet')) {
                    zoomOut();
                    drawers.forEach(d => closeDrawerAnim(d));
                }
            });

            // ── GIRO 360 DEL ARMARIO (drag) ──
            const cabinet = document.getElementById('cabinet');
            let rotY = -22;    // ángulo inicial Y
            let rotX = 0;     // ángulo inicial X — raso total
            let dragging = false;
            let startX = 0, startY = 0;
            let startRotY = rotY, startRotX = rotX;

            function applyRotation() {
                cabinet.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
            }

            cabinet.addEventListener('mousedown', e => {
                if (focusedDrawer) return; // sin drag cuando hay cajón en zoom
                dragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startRotY = rotY;
                startRotX = rotX;
                cabinet.style.cursor = 'grabbing';
                e.preventDefault();
            });
            window.addEventListener('mousemove', e => {
                if (!dragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                rotY = startRotY + dx * 0.4;
                rotX = startRotX + dy * 0.4;
                applyRotation();
            });
            window.addEventListener('mouseup', () => {
                dragging = false;
                cabinet.style.cursor = 'grab';
            });

            // Touch
            cabinet.addEventListener('touchstart', e => {
                dragging = true;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                startRotY = rotY;
                startRotX = rotX;
            }, { passive: true });
            window.addEventListener('touchmove', e => {
                if (!dragging) return;
                const dx = e.touches[0].clientX - startX;
                const dy = e.touches[0].clientY - startY;
                rotY = startRotY + dx * 0.4;
                rotX = startRotX + dy * 0.4;
                applyRotation();
            }, { passive: true });
            window.addEventListener('touchend', () => { dragging = false; });

            cabinet.style.cursor = 'grab';

            // Actualizar contadores de autores en cajón 3
            if (typeof POSTS !== 'undefined') {
                document.querySelectorAll('.cab-author-count').forEach(el => {
                    const slug = el.dataset.slug;
                    const count = POSTS.filter(p => p.authorSlug === slug).length;
                    el.textContent = `${count} ${count === 1 ? 'entrada' : 'entradas'}`;
                });
            }

            // ── DARK MODE ──
            const darkBtn = document.getElementById('dark-toggle');
            if (darkBtn) {
                darkBtn.addEventListener('click', () => {
                    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                    document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
                    localStorage.setItem('theme', isDark ? 'light' : 'dark');
                });
            }

            // ── VOLVER ARRIBA ──
            const backBtn = document.getElementById('back-to-top');
            if (backBtn) {
                window.addEventListener('scroll', () => backBtn.classList.toggle('visible', window.scrollY > 600));
                backBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            }


            // ── NAVBAR WORDMARK ──
            const navWordmark = document.getElementById('nav-wordmark');
            if (navWordmark) {
                const THRESHOLD = 80;
                let isCollapsed = false;
                function updateWordmark() {
                    const shouldCollapse = window.scrollY > THRESHOLD;
                    if (shouldCollapse !== isCollapsed) {
                        isCollapsed = shouldCollapse;
                        navWordmark.classList.toggle('collapsed', isCollapsed);
                    }
                }
                window.addEventListener('scroll', updateWordmark, { passive: true });
                updateWordmark();
            }
        });
    </script>
</body>
</html>
