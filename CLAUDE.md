# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

```bash
npm install       # Install dependencies (marked, gray-matter)
npm run build     # Run the static site generator (scripts/build.js)
```

There is no test suite. The build pipeline serves as the validation step — if `build.js` completes without errors, the output is considered valid.

## Architecture

NousArchives is a collaborative static blog. Authors write Markdown files; a Node.js build script converts them to HTML and publishes them automatically via GitHub Actions.

### Build pipeline (`scripts/build.js`)

The build script is the core of the project. It:
1. Scans each author directory (`angel/`, `javi/`, `antonio/`) for `.md` files
2. Parses YAML frontmatter with `gray-matter` and converts Markdown to HTML with `marked`
3. Generates individual `.html` article pages alongside the source `.md` files
4. Outputs `scripts/posts.js` — a JS file exporting a `POSTS` array of all post metadata
5. Cleans up orphaned `.html` files (deleted if their corresponding `.md` is gone)

`scripts/posts.js` is auto-generated on every build — do not edit it manually.

### Rendering model (hybrid static + client-side)

Individual article pages are fully static HTML generated by `build.js`. Author index pages (`angel/index.html`, `javi/index.html`, etc.) are shells that load the `POSTS` array at runtime from `posts.js` and render their articles client-side using vanilla JavaScript.

### Content model

Every `.md` article must have this YAML frontmatter:

```yaml
---
title: Article title
tldr: 1-2 sentence summary
date: YYYY-MM-DD
type: articulo|comentario|respuesta|ensayo
tags: [ia, cine, literatura, musica, ml, derecho]
readtime: 8 min
author: Author Name       # auto-filled by build.js
authorSlug: angel|javi|antonio
---
```

`build.js` reads `authorSlug` to assign the author and infer the author's display name. The `author` field in the generated `posts.js` is set automatically.

### CI/CD (`.github/workflows/publish.yml`)

Pushes to `main` that touch author Markdown files trigger the pipeline:
1. `npm install` + `node scripts/build.js`
2. The bot auto-commits generated `.html` and `posts.js` with `[skip ci]` in the message to prevent loops
3. GitHub Pages (`static.yml`) serves the resulting static files

### Adding a new author

1. Create a new directory with the author's slug name
2. Add their `index.html` (copy from an existing author's)
3. Register them in `scripts/build.js` in the `AUTHORS` array (or equivalent author list)
